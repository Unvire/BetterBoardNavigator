<!doctype html>
<html>
    <head>
        <meta charset="utf-8"/>
        <script type="text/javascript" src="static/js/brython.js"></script>
        <script type="text/javascript" src="static/js/brython_stdlib.js"></script>
        <script src="https://cdn.jsdelivr.net/pyodide/v0.25.1/full/pyodide.js"></script>        
        <script type="text/python" src="static/brython/drawFunctions.py" id="drawFunctions"></script>
        <script type="text/python" src="static/python/geometryObjects.py" id="geometryObjects"></script>
        <script type="text/python" src="static/python/abstractShape.py" id="abstractShape"></script>   
        <script type="text/python" src="static/python/pin.py" id="pin"></script>     
        <script type="text/python" src="static/python/component.py" id="component"></script>
        <script type="text/python" src="static/python/board.py" id="board"></script>
        <script type="text/python" src="static/python/camcadLoader.py" id="camcadLoader"></script>
        <script type="text/python" src="static/python/gencadLoader.py" id="gencadLoader"></script>
        <script type="text/python" src="static/python/unlzw3.py" id="unlzw3"></script>
        <script type="text/python" src="static/python/odbPlusPlusLoader.py" id="odbPlusPlusLoader"></script>
        <script type="text/python" src="static/python/loaderSelectorFactory.py" id="loaderSelectorFactory"></script>
    </head>

    <body onload="brython(1)">        
        <input type="file" id="fileInput">
        <button id="loadButton">Wczytaj Plik</button>
        <canvas id="myCanvas" width="1500" height="700" style="border:1px solid #000000;"></canvas>
        <div id="fileContent"></div>
        <script type="text/python" id="drawTest">
            from browser import document
            import drawFunctions
            import geometryObjects as gobj

            canvas = document['myCanvas']
            context = canvas.getContext('2d')
            drawFunctions.drawLine(context, (300, 300), (450, 450), 'green', 2)
            drawFunctions.drawRectangle(context, (50, 50), (250, 150), 'blue', 5)
            drawFunctions.drawCircle(context, (150, 450), 50, 'red', 3, True, 'yellow')
            drawFunctions.drawArc(context, (380, 150), 100, 5.497787143782138, 0.2617993877991494, 'blue', 2, True, 'red')
            drawFunctions.drawPolygon(context, [(600, 300), (720, 400), (200, 230)], 'black', 2, True, 'green')
            document <= gobj.Point(10, 10).__str__()
        </script>        
        <script type="text/python">
            from browser import document, window, alert
            from loaderSelectorFactory import LoaderSelectorFactory
            from board import Board
            
            def read_file(ev):
                file_input = document['fileInput']
                if file_input.files.length == 0:
                    alert("Proszę wybrać plik tekstowy.")
                    return
    
                file = file_input.files[0]                
                reader = window.FileReader.new()
                print(file.name)
    
                def onload(event):                
                    file_content = document['fileContent']
                    fileLines = reader.result.split('\r\n')
                    file_content.text = fileLines
                    boardLoader = LoaderSelectorFactory(file.name)
                    boardInstance = boardLoader.processFileLines(fileLines)
                    #file_content.text = file_content.text + len(boardInstance.getComponents())  # Wstaw zawartość pliku do diva
    
                def onerror(event):
                    alert("Nie można odczytać pliku.")
    
                reader.bind('load', onload)
                reader.bind('error', onerror)
                reader.readAsText(file)  # Odczytaj plik jako tekst
    
            document['fileInput'].bind('change', read_file)  # Automatyczne ładowanie po wybraniu pliku
        </script>
    </body>
</html>